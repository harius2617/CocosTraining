{"version":3,"sources":["controlSp.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","spAnim","sp","Skeleton","canMove","bullets","Prefab","stepSound","AudioClip","gunSound","onLoad","manager","director","getCollisionManager","enabled","enabledDebugDraw","instance","registerEvent","moveRight","bind","moveLeft","jump","shoot","start","setEventListener","entry","event","data","audioStep","audioEngine","play","onCollisionEnter","other","self","onCollisionStay","node","x","log","onCollisionExit","console","setAnimation","tween","to","scaleX","by","position","v2","addAnimation","easing","bullet","instantiate","addChild","shootSound"],"mappings":"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","file":"controlSp.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["const Emitter = require('mEmitter');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n    //    isColli: false,\n       spAnim: sp.Skeleton,\n       canMove: true,\n       bullets: cc.Prefab,\n       stepSound: cc.AudioClip,\n       gunSound: cc.AudioClip\n    },\n\n    onLoad () {\n        let manager = cc.director.getCollisionManager();\n        manager.enabled = true;\n        manager.enabledDebugDraw = true;\n        // cc.tween(this.node).by(10, {position: cc.v2(1000, 0)}).start()\n        Emitter.instance = new Emitter();\n        Emitter.instance.registerEvent(\"RIGHT\", this.moveRight.bind(this));\n        Emitter.instance.registerEvent(\"LEFT\", this.moveLeft.bind(this));\n        Emitter.instance.registerEvent(\"JUMP\", this.jump.bind(this))\n        Emitter.instance.registerEvent('SHOOT', this.shoot.bind(this))\n\n    },\n\n    start() {\n        this.spAnim.setEventListener((entry, event)=> {\n            const {data} = event;\n            let audioStep = cc.audioEngine.play(this.stepSound, false, 1);\n        });\n    },\n\n    onCollisionEnter: function (other, self) {\n        // this.isColli = true;\n        // if(other.tag === 0 && self.tag == 0 ) {\n            // this.spAnim.setAnimation(0, \"jump\", false);\n            // this.spAnim.addAnimation(0, \"walk\", true)\n            // this.node.y += 100;\n            // cc.tween(this.node)\n            //     .by(0.5, {position: cc.v2(50, 100)})\n            //     .by(0.5, {position: cc.v2(0, -100)})\n            //     .start()\n        //     return\n        // }else if(other.tag === 1) { \n        //     if(!this.shoot()){\n        //         this.canMove = false\n        //     }else{\n        //         other.node.destroy()\n\n            // }\n            // this.spAnim.setAnimation(0, \"shoot\", false);\n            // cc.tween(this.node)\n            // .delay(0.5)\n            // .call(()=>{\n            //     this.canMove = true\n                \n            // })\n            // .start()\n            // this.spAnim.addAnimation(0, \"walk\", true);\n            // this.shoot()\n        // }\n        // cc.log(this.spAnim.animation)\n        // console.log('on collision enter');\n        // if(other.tag === 1 && self.tag === 0 ) {\n        //     // this.canMove = false;\n        //         // other.node.destroy();\n        //         // this.canMove = true;\n        //     this.shoot()\n        //     other.node.destroy()\n        // }\n        // if(other.tag === 0 && self.tag === 3) {\n        //     self.node.destroy()\n        // }\n    },\n\n    onCollisionStay: function(other, self){\n        this.node.x -= 10\n        cc.log(\"collition stay\")\n    },\n    \n    onCollisionExit: function (other, self) {\n        console.log('on collision exit');\n        // this.spAnim.setAnimation(0, \"walk\", true)\n    },\n\n    moveRight() {\n        if(!this.canMove) return;\n        this.spAnim.setAnimation(0, \"walk\", false)\n        cc.tween(this.node) \n            .to(0, {scaleX: 0.1})\n            .by(0.2, {position: cc.v2(20,0)})\n            .start()\n        this.spAnim.addAnimation(0,\"idle\", false)\n        \n    },\n\n    moveLeft() {\n        if(!this.canMove) return;\n        this.spAnim.setAnimation(0, \"walk\", false)\n        cc.tween(this.node)\n            .to(0, {scaleX: -0.1})\n            .by(0.1, {position: cc.v2(-20,0)})\n            .start()\n        this.spAnim.addAnimation(0,\"idle\", false)\n        \n    },\n\n    jump() {\n        this.spAnim.setAnimation(0, \"jump\", false)\n        if(this.node.scaleX === 0.1){\n            cc.tween(this.node)\n                .by(0.5, {position: cc.v2(60, 100)},{easing: \"quintInOut\"})\n                .by(0.5, {position: cc.v2(40, -100)})\n                .start()\n        }else if(this.node.scaleX === -0.1) {\n            cc.tween(this.node)\n                .by(0.5, {position: cc.v2(-60, 100)},{easing: \"quintInOut\"})\n                .by(0.5, {position: cc.v2(-40, -100)})\n                .start()\n        }\n        this.spAnim.addAnimation(0,\"idle\", false)\n    },\n\n    shoot() {\n        let bullet = cc.instantiate(this.bullets)\n        this.node.addChild(bullet);\n        let shootSound = cc.audioEngine.play(this.gunSound, false, 1)\n        this.spAnim.setAnimation(0, \"shoot\", false)\n        cc.tween(bullet)\n            .by(10, {position: cc.v2(15000, 0)})\n            .start()\n        this.spAnim.addAnimation(0, 'idle', true)\n    },\n\n});\n"]}