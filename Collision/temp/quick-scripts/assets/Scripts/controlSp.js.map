{"version":3,"sources":["controlSp.js"],"names":["Emitter","require","cc","Class","extends","Component","properties","spAnim","sp","Skeleton","canMove","bullets","Prefab","stepSound","AudioClip","gunSound","onLoad","manager","director","getCollisionManager","enabled","enabledDebugDraw","instance","registerEvent","moveRight","bind","moveLeft","jump","shoot","start","_firstY","node","y","setEventListener","entry","event","data","audioStep","audioEngine","play","onCollisionEnter","other","self","onCollisionStay","scaleX","x","log","onCollisionExit","console","setAnimation","tween","to","by","position","v2","addAnimation","easing","bullet","instantiate","addChild","shootSound"],"mappings":"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","file":"controlSp.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["const Emitter = require('mEmitter');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n       spAnim: sp.Skeleton,\n       canMove: true,\n       bullets: cc.Prefab,\n       stepSound: cc.AudioClip,\n       gunSound: cc.AudioClip,\n    },\n\n    onLoad () {\n        let manager = cc.director.getCollisionManager();\n        manager.enabled = true;\n        manager.enabledDebugDraw = true;\n        Emitter.instance = new Emitter();\n        Emitter.instance.registerEvent(\"RIGHT\", this.moveRight.bind(this));\n        Emitter.instance.registerEvent(\"LEFT\", this.moveLeft.bind(this));\n        Emitter.instance.registerEvent(\"JUMP\", this.jump.bind(this));\n        Emitter.instance.registerEvent('SHOOT', this.shoot.bind(this));\n    },\n\n    start() {\n        this._firstY = this.node.y\n\n        this.spAnim.setEventListener((entry, event)=> {\n            const {data} = event;\n            let audioStep = cc.audioEngine.play(this.stepSound, false, 1);\n        });\n    },\n\n    onCollisionEnter: function (other, self) {\n    },\n\n    onCollisionStay: function(other, self){\n        if(this.node.scaleX === 0.1) {\n            this.node.x -= 10\n        }else if(this.node.scaleX === -0.1) {\n            this.node.x += 10\n        }\n        cc.log(\"collition stay\")\n    },\n    \n    onCollisionExit: function (other, self) {\n        console.log('on collision exit');\n    },\n\n    moveRight() {\n        if(!this.canMove) return;\n        this.spAnim.setAnimation(0, \"walk\", false)\n        cc.tween(this.node) \n            .to(0, {scaleX: 0.1})\n            .by(0.2, {position: cc.v2(20,0)})\n            .start()\n        this.spAnim.addAnimation(0,\"idle\", false)\n        \n    },\n\n    moveLeft() {\n        if(!this.canMove) return;\n        this.spAnim.setAnimation(0, \"walk\", false)\n        cc.tween(this.node)\n            .to(0, {scaleX: -0.1})\n            .by(0.1, {position: cc.v2(-20,0)})\n            .start()\n        this.spAnim.addAnimation(0,\"idle\", false)\n        \n    },\n\n    jump() {\n        this.spAnim.setAnimation(0, \"jump\", false)\n        if(this.node.scaleX === 0.1){\n            cc.tween(this.node)\n                .by(0.5, {position: cc.v2(60, 100)},{easing: \"quintInOut\"})\n                .by(0.5, {position: cc.v2(40, -100)})\n                .start()\n        }else if(this.node.scaleX === -0.1) {\n            cc.tween(this.node)\n                .by(0.5, {position: cc.v2(-60, 100)},{easing: \"quintInOut\"})\n                .by(0.5, {position: cc.v2(-40, -100)})\n                .start()\n        }\n\n        this.spAnim.addAnimation(0,\"idle\", false)\n    },\n\n    shoot() {\n        let bullet = cc.instantiate(this.bullets)\n        this.node.addChild(bullet);\n        let shootSound = cc.audioEngine.play(this.gunSound, false, 1)\n        this.spAnim.setAnimation(0, \"shoot\", false)\n        cc.tween(bullet)\n            .by(10, {position: cc.v2(15000, 0)})\n            .start()\n        this.spAnim.addAnimation(0, 'idle', true)\n    },\n\n});\n"]}